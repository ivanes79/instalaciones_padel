

	
	
-- QUERY 1 QUIERO SABER EL NOMBRE DE LOS JUGADORES Y EL NOMBRE DEL NIVEL QUE TIENEN PERO SOLO LOS QUE ESTEN REGISTRADOS EN UNA INSTALACION

SELECT 3100_nomcliente, 3000_nomnivel, 1100_idinstalacion 
	FROM 3000_NIVELES
	INNER JOIN 3100_CLIENTES
	ON 3000_NIVELES.3000_idnivel = 3100_CLIENTES.3000_idnivel
	INNER JOIN 3120_REGISTROCLIENTES
	ON 3100_CLIENTES.3100_idcliente = 3120_REGISTROCLIENTES.3100_idcliente
	ORDER BY 3100_nomcliente;
	
	
SELECT 3100_nomcliente, 3000_nomnivel, 1100_idinstalacion 
	FROM 3000_NIVELES, 3100_CLIENTES, 3120_REGISTROCLIENTES
	WHERE 3000_NIVELES.3000_idnivel = 3100_CLIENTES.3000_idnivel
	AND 3100_CLIENTES.3100_idcliente = 3120_REGISTROCLIENTES.3100_idcliente
	ORDER BY 3100_nomcliente;
	
-- QUERY 2 QUIERO SABER LOS INGRESOS POR TODOS LOS CURSOS EN LA INSTALACION "INDOOR PADEL TRAINING"
 
	
SELECT SUM( 1111_CURSOS.1111_preciocurso ) AS INGRESOSCURSOS
	FROM 1100_INSTALACIONESPADEL
	INNER JOIN 1110_PISTAS
	ON 1100_INSTALACIONESPADEL.1100_idinstalacion = 1110_PISTAS.1100_idinstalacion
	INNER JOIN 1111_CURSOS
	ON 1110_PISTAS.1110_idpista = 1111_CURSOS.1110_idpista
	AND 1110_PISTAS.1100_idinstalacion = 1111_CURSOS.1100_idinstalacion
	WHERE 1100_INSTALACIONESPADEL.1100_nominstalacion = "INDOOR PADEL TRAINING";

SELECT SUM( 1111_CURSOS.1111_preciocurso ) AS INGRESOSCURSOS
	FROM 1100_INSTALACIONESPADEL, 1110_PISTAS, 1111_CURSOS
	WHERE 1100_INSTALACIONESPADEL.1100_idinstalacion = 1110_PISTAS.1100_idinstalacion
	AND 1110_PISTAS.1110_idpista = 1111_CURSOS.1110_idpista
	AND 1110_PISTAS.1100_idinstalacion = 1111_CURSOS.1100_idinstalacion
	AND 1100_INSTALACIONESPADEL.1100_nominstalacion = "INDOOR PADEL TRAINING";	
		

-- QUERY 3 QUIERO SABER CUANTOS CLIENTES HAY EN CADA CURSO

	
SELECT CASE 
			WHEN `1111_idcurso` IS NULL 
			THEN "Total:" 
			ELSE `1111_idcurso` 
		END AS `1111_idcurso`, 
	COUNT( 1111A_REGISTROSCURSOS.3100_idcliente ) AS NUMALUMNOS
	FROM 1111A_REGISTROSCURSOS
	INNER JOIN 3120_REGISTROCLIENTES
	ON 1111A_REGISTROSCURSOS.3100_idcliente = 3120_REGISTROCLIENTES.3100_idcliente
	GROUP BY 1111A_REGISTROSCURSOS.1111_idcurso WITH ROLLUP;



-- QUERY 4.QUIERO SABER QUE CURSOS TENGO EN LA INSTALACION "TIX PADEL INDOOR" Y LOS PROFESORES LO DAN ESOS CURSOS

SELECT DISTINCT 1111_idcurso,2000_nomprofesor
	FROM 1100_INSTALACIONESPADEL
	INNER JOIN 1110_PISTAS
	ON 1100_INSTALACIONESPADEL.1100_idinstalacion = 1110_PISTAS.1100_idinstalacion
	INNER JOIN 1111_CURSOS
	ON 1110_PISTAS.1110_idpista = 1111_CURSOS.1110_idpista
	AND 1110_PISTAS.1100_idinstalacion = 1111_CURSOS.1100_idinstalacion
	INNER JOIN 2000_PROFESORES
	ON 1111_CURSOS.2000_idprofesor = 2000_PROFESORES.2000_idprofesor
	WHERE 1100_INSTALACIONESPADEL.1100_nominstalacion = "TIX PADEL INDOOR";
	
	
SELECT DISTINCT 1111_idcurso,2000_nomprofesor
	FROM 1100_INSTALACIONESPADEL, 1110_PISTAS, 1111_CURSOS, 2000_PROFESORES
	WHERE 1100_INSTALACIONESPADEL.1100_idinstalacion = 1110_PISTAS.1100_idinstalacion
	AND 1110_PISTAS.1110_idpista = 1111_CURSOS.1110_idpista
	AND 1110_PISTAS.1100_idinstalacion = 1111_CURSOS.1100_idinstalacion
	AND 1111_CURSOS.2000_idprofesor = 2000_PROFESORES.2000_idprofesor
	AND 1100_INSTALACIONESPADEL.1100_nominstalacion = "TIX PADEL INDOOR";


-- QUERY 5.QUIERO SABER EL NOMBRE Y LA INSTALACION DE LOS CLIENTES QUE ESTAN REGISTRADOS Y QUE SU TELEFONO EMPIECE POR 629

SELECT 3100_nomcliente,1100_nominstalacion 
	FROM 1100_INSTALACIONESPADEL
	INNER JOIN 3120_REGISTROCLIENTES
	ON 1100_INSTALACIONESPADEL.1100_idinstalacion = 3120_REGISTROCLIENTES.1100_idinstalacion
	INNER JOIN 3100_CLIENTES
	ON 3120_REGISTROCLIENTES.3100_idcliente = 3100_CLIENTES.3100_idcliente
	WHERE 3100_numtelefono LIKE "629%";
	
SELECT 3100_nomcliente,1100_nominstalacion 
	FROM 1100_INSTALACIONESPADEL, 3120_REGISTROCLIENTES, 3100_CLIENTES
	WHERE 1100_INSTALACIONESPADEL.1100_idinstalacion = 3120_REGISTROCLIENTES.1100_idinstalacion
	AND 3120_REGISTROCLIENTES.3100_idcliente = 3100_CLIENTES.3100_idcliente
	AND 3100_numtelefono LIKE "629%";
	
		
-- QUERY 6.QUIERO SABER EL NOMBRE DE LOS CIENTES QUE SE HAYAN REGISTRADO ENTRE 2018 Y 2019 Y EN QUE INSTALACION ESTAN REGISTRADOS

SELECT 3100_CLIENTES.3100_nomcliente, 1100_INSTALACIONESPADEL.1100_idinstalacion 
	FROM 3100_CLIENTES
	INNER JOIN 3120_REGISTROCLIENTES
	ON 3100_CLIENTES.3100_idcliente = 3120_REGISTROCLIENTES.3100_idcliente
	INNER JOIN 1100_INSTALACIONESPADEL
	ON 3120_REGISTROCLIENTES.1100_idinstalacion = 1100_INSTALACIONESPADEL.1100_idinstalacion 
	WHERE YEAR( 3120_REGISTROCLIENTES.3120_fecregistro ) BETWEEN "2018" AND "2019";
	
SELECT 3100_CLIENTES.3100_nomcliente, 1100_INSTALACIONESPADEL.1100_idinstalacion 
	FROM 3100_CLIENTES, 3120_REGISTROCLIENTES, 1100_INSTALACIONESPADEL
	WHERE 3100_CLIENTES.3100_idcliente = 3120_REGISTROCLIENTES.3100_idcliente
	AND 3120_REGISTROCLIENTES.1100_idinstalacion = 1100_INSTALACIONESPADEL.1100_idinstalacion
	AND YEAR( 3120_REGISTROCLIENTES.3120_fecregistro ) BETWEEN "2018" AND "2019";
	 

	
	
-- Query 7 quiero ver el nombre y la foto de los clientes que tienen el horario 13:00 - 14:30 en su curso y que iniciaron el curso despues de la fecha de alta del mismo 

SELECT 3100_nomcliente, 3110_nomficherofoto
	FROM 4000_HORARIOS 
	INNER JOIN 4111_HORARIOSCURSOS
	ON 4000_HORARIOS.4000_idhorario = 4111_HORARIOSCURSOS.4000_idhorario
	INNER JOIN 1111_CURSOS
	ON 4111_HORARIOSCURSOS.1111_idcurso = 1111_CURSOS.1111_idcurso
	INNER JOIN 1111A_REGISTROSCURSOS
	ON 1111_CURSOS.1111_idcurso = 1111A_REGISTROSCURSOS.1111_idcurso
	AND 1111_CURSOS.1100_idinstalacion = 1111A_REGISTROSCURSOS.1100_idinstalacion
	INNER JOIN 3120_REGISTROCLIENTES
	ON 1111A_REGISTROSCURSOS.3100_idcliente = 3120_REGISTROCLIENTES.3100_idcliente
	AND 1111A_REGISTROSCURSOS.1100_idinstalacion = 3120_REGISTROCLIENTES.1100_idinstalacion
	INNER JOIN 3100_CLIENTES
	ON 3120_REGISTROCLIENTES.3100_idcliente = 3100_CLIENTES.3100_idcliente
	INNER JOIN 3110_FOTOCLIENTES
	ON 3100_CLIENTES.3100_idcliente = 3110_FOTOCLIENTES.3100_idcliente
	WHERE 4000_HORARIOS.4000_horario = "13:00 - 14:30"
	AND 1111A_REGISTROSCURSOS.1111A_fecinicio > 4111_HORARIOSCURSOS.4111_fecalta;
	
	
SELECT 3100_nomcliente, 3110_nomficherofoto
	FROM 4000_HORARIOS, 4111_HORARIOSCURSOS, 1111_CURSOS, 1111A_REGISTROSCURSOS, 3120_REGISTROCLIENTES, 3100_CLIENTES, 3110_FOTOCLIENTES 
	WHERE 4000_HORARIOS.4000_idhorario = 4111_HORARIOSCURSOS.4000_idhorario
	AND 4111_HORARIOSCURSOS.1111_idcurso = 1111_CURSOS.1111_idcurso
	AND 1111_CURSOS.1111_idcurso = 1111A_REGISTROSCURSOS.1111_idcurso
	AND 1111_CURSOS.1100_idinstalacion = 1111A_REGISTROSCURSOS.1100_idinstalacion
	AND 1111A_REGISTROSCURSOS.3100_idcliente = 3120_REGISTROCLIENTES.3100_idcliente
	AND 1111A_REGISTROSCURSOS.1100_idinstalacion = 3120_REGISTROCLIENTES.1100_idinstalacion
	AND 3120_REGISTROCLIENTES.3100_idcliente = 3100_CLIENTES.3100_idcliente
	AND 3100_CLIENTES.3100_idcliente = 3110_FOTOCLIENTES.3100_idcliente
	AND 4000_HORARIOS.4000_horario = "13:00 - 14:30"
	AND 1111A_REGISTROSCURSOS.1111A_fecinicio > 4111_HORARIOSCURSOS.4111_fecalta;
	
 
-- QUERY 8. QUIERO SABER EL NOMBRE DE LOS CLIENTES QUE ESTAN APUNTADOS A UN CURSO, QUE SE REGISTRARON EN UNA INSTALACION EL MISMO AÑO DE CREACION DE LA ESCUELA,
-- QUE SU NIVEL SEA 3 O 4 Y TAMBIEN SABER EL NOMBRE DEL PROFESOR DE SU CURSO Y SU FOTO 

	
SELECT 3100_CLIENTES.3100_nomcliente, 2000_PROFESORES.2000_nomprofesor, 2000_PROFESORES.2000_nomfotoprofesor
	FROM 2000_PROFESORES 
	INNER JOIN 1111_CURSOS
	ON 2000_PROFESORES.2000_idprofesor = 1111_CURSOS.2000_idprofesor
	INNER JOIN 1111A_REGISTROSCURSOS
	ON 1111_CURSOS.1111_idcurso = 1111A_REGISTROSCURSOS.1111_idcurso
	AND 1111_CURSOS.1100_idinstalacion = 1111A_REGISTROSCURSOS.1100_idinstalacion
	INNER JOIN 3120_REGISTROCLIENTES
	ON 1111A_REGISTROSCURSOS.3100_idcliente = 3120_REGISTROCLIENTES.3100_idcliente
	AND 1111A_REGISTROSCURSOS.1100_idinstalacion = 3120_REGISTROCLIENTES.1100_idinstalacion 
	INNER JOIN 1100_INSTALACIONESPADEL
	ON 3120_REGISTROCLIENTES.1100_idinstalacion = 1100_INSTALACIONESPADEL.1100_idinstalacion	
	INNER JOIN 1000_ESCUELASPADEL
	ON 1100_INSTALACIONESPADEL.1000_idescuela = 1000_ESCUELASPADEL.1000_idescuela
	INNER JOIN 3100_CLIENTES
	ON 3120_REGISTROCLIENTES.3100_idcliente = 3100_CLIENTES.3100_idcliente
	WHERE YEAR( 1000_ESCUELASPADEL.1000_feccreacion ) = YEAR( 3120_REGISTROCLIENTES.3120_fecregistro )
	AND 3100_CLIENTES.3000_idnivel IN( "3","4");
	
	 
SELECT 3100_CLIENTES.3100_nomcliente, 2000_PROFESORES.2000_nomprofesor, 2000_PROFESORES.2000_nomfotoprofesor
	FROM 2000_PROFESORES, 1111_CURSOS, 1111A_REGISTROSCURSOS, 3120_REGISTROCLIENTES, 1100_INSTALACIONESPADEL, 1000_ESCUELASPADEL, 3100_CLIENTES
	WHERE 2000_PROFESORES.2000_idprofesor = 1111_CURSOS.2000_idprofesor	
	AND 1111_CURSOS.1111_idcurso = 1111A_REGISTROSCURSOS.1111_idcurso
	AND 1111_CURSOS.1100_idinstalacion = 1111A_REGISTROSCURSOS.1100_idinstalacion	
	AND 1111A_REGISTROSCURSOS.3100_idcliente = 3120_REGISTROCLIENTES.3100_idcliente
	AND 1111A_REGISTROSCURSOS.1100_idinstalacion = 3120_REGISTROCLIENTES.1100_idinstalacion
	AND 3120_REGISTROCLIENTES.1100_idinstalacion = 1100_INSTALACIONESPADEL.1100_idinstalacion		
	AND 1100_INSTALACIONESPADEL.1000_idescuela = 1000_ESCUELASPADEL.1000_idescuela	
	AND 3120_REGISTROCLIENTES.3100_idcliente = 3100_CLIENTES.3100_idcliente
	AND YEAR( 1000_ESCUELASPADEL.1000_feccreacion ) = YEAR( 3120_REGISTROCLIENTES.3120_fecregistro )
	AND 3100_CLIENTES.3000_idnivel IN( "3","4" );
	



-- QUERY 9 QUIERO SABER EL NUMERO DE LAS PISTAS QUE TIENEN EL PRECIO MAS CARO

SELECT 1110_numpista
	FROM 1110_PISTAS
	WHERE 1110_preciohorapista = ( SELECT MAX( 1110_preciohorapista )
									FROM 1110_PISTAS );
								
								
-- QUERY 10 QUIERO SABER EL NOMBRE DE LAS INSTALACIONES QUE NO TIENEN CURSOS REGISTRADOS

SELECT 1100_nominstalacion
	FROM 1111A_REGISTROSCURSOS
	INNER JOIN 3120_REGISTROCLIENTES
	ON 1111A_REGISTROSCURSOS.3100_idcliente = 3120_REGISTROCLIENTES.3100_idcliente
	AND 1111A_REGISTROSCURSOS.1100_idinstalacion = 3120_REGISTROCLIENTES.1100_idinstalacion	
	RIGHT JOIN 1100_INSTALACIONESPADEL
	ON 3120_REGISTROCLIENTES.1100_idinstalacion = 1100_INSTALACIONESPADEL.1100_idinstalacion
	WHERE 1111A_REGISTROSCURSOS.1111_idcurso IS NULL;
			
	
-- QUERY 11 quiero saber cuanto paga cada cliente en cada curso

	
	
WITH Q1 AS ( SELECT  1111_CURSOS.1111_idcurso, 
					 1111_CURSOS.1111_preciocurso, 
					 COUNT( * ) AS NUMCLIENTES
					 FROM 1111_CURSOS, 1111A_REGISTROSCURSOS
					 WHERE 1111_CURSOS.1111_idcurso = 1111A_REGISTROSCURSOS.1111_idcurso
					 AND 1111_CURSOS.1100_idinstalacion = 1111A_REGISTROSCURSOS.1100_idinstalacion
					 GROUP BY 1111_CURSOS.1111_idcurso )
    
SELECT 1111_idcurso, 1111_preciocurso, NUMCLIENTES, ROUND( 1111_preciocurso / NUMCLIENTES, 2 )AS PAGOPORCLIENTE
 FROM Q1;
 
	
	
	
-- QUERY 12 QUIERO SABER LOS CURSOS EN LOS QUE TENGO CLIENTES REGISTRADOS, QUE SE HAN DADO DE ALTA EN ESTE AÑO 

SELECT DISTINCT 1111A_REGISTROSCURSOS.1111_idcurso, 4111_HORARIOSCURSOS.4111_fecalta
	FROM 1111A_REGISTROSCURSOS
	INNER JOIN 1111_CURSOS
	ON 1111A_REGISTROSCURSOS.1111_idcurso = 1111_CURSOS.1111_idcurso
	AND 1111A_REGISTROSCURSOS.1100_idinstalacion = 1111_CURSOS.1100_idinstalacion
	INNER JOIN 4111_HORARIOSCURSOS
	ON 1111_CURSOS.1111_idcurso = 4111_HORARIOSCURSOS.1111_idcurso
	WHERE YEAR( 4111_HORARIOSCURSOS.4111_fecalta ) = YEAR ( NOW() )
	ORDER BY 1111A_REGISTROSCURSOS.1111_idcurso;


SELECT DISTINCT 1111A_REGISTROSCURSOS.1111_idcurso, 4111_HORARIOSCURSOS.4111_fecalta
	FROM 1111A_REGISTROSCURSOS, 1111_CURSOS, 4111_HORARIOSCURSOS
	WHERE 1111A_REGISTROSCURSOS.1111_idcurso = 1111_CURSOS.1111_idcurso
	AND 1111A_REGISTROSCURSOS.1100_idinstalacion = 1111_CURSOS.1100_idinstalacion
	AND 1111_CURSOS.1111_idcurso = 4111_HORARIOSCURSOS.1111_idcurso
	AND YEAR( 4111_HORARIOSCURSOS.4111_fecalta ) = YEAR ( NOW() );
	



 


-- -- QUERY 13.QUIERO SABER EL NOMBRE DE LOS CLIENTES Y EL CURSO EN EL QUE ESTAN APUNTADOS PERO SOLO CUYO IMPORTE ESTA 
-- POR DEBAJO DE LA MEDIA DEL IMPORTE DE LOS CURSOS DE LOS AÑOS ANTERIORES  


SELECT 3100_CLIENTES.3100_nomcliente, 1111_CURSOS.1111_idcurso
	FROM 3100_CLIENTES 
	INNER JOIN 3120_REGISTROCLIENTES
	ON 3100_CLIENTES.3100_idcliente = 3120_REGISTROCLIENTES.3100_idcliente
	INNER JOIN 1111A_REGISTROSCURSOS
	ON 3120_REGISTROCLIENTES.3100_idcliente = 1111A_REGISTROSCURSOS.3100_idcliente
	AND 3120_REGISTROCLIENTES.1100_idinstalacion = 1111A_REGISTROSCURSOS.1100_idinstalacion
	INNER JOIN 1111_CURSOS
	ON 1111A_REGISTROSCURSOS.1111_idcurso = 1111_CURSOS.1111_idcurso
	AND 1111A_REGISTROSCURSOS.1100_idinstalacion = 1111_CURSOS.1100_idinstalacion
	WHERE 1111_CURSOS.1111_preciocurso < ( SELECT ROUND( AVG( 1111_CURSOS.1111_preciocurso ),2 )AS MEDIACURSOS 
												FROM 1111_CURSOS
												INNER JOIN 4111_HORARIOSCURSOS
												ON 1111_CURSOS.1111_idcurso = 4111_HORARIOSCURSOS.1111_idcurso
												WHERE YEAR( 4111_fecalta ) < YEAR ( NOW() ) );
												
SELECT 3100_CLIENTES.3100_nomcliente, 1111_CURSOS.1111_idcurso
	FROM 3100_CLIENTES, 3120_REGISTROCLIENTES, 1111A_REGISTROSCURSOS, 1111_CURSOS 
	WHERE 3100_CLIENTES.3100_idcliente = 3120_REGISTROCLIENTES.3100_idcliente
	AND 3120_REGISTROCLIENTES.3100_idcliente = 1111A_REGISTROSCURSOS.3100_idcliente
	AND 3120_REGISTROCLIENTES.1100_idinstalacion = 1111A_REGISTROSCURSOS.1100_idinstalacion
	AND 1111A_REGISTROSCURSOS.1111_idcurso = 1111_CURSOS.1111_idcurso
	AND 1111A_REGISTROSCURSOS.1100_idinstalacion = 1111_CURSOS.1100_idinstalacion
	AND 1111_CURSOS.1111_preciocurso < ( SELECT ROUND( AVG( 1111_CURSOS.1111_preciocurso ),2 )AS MEDIACURSOS 
												FROM 1111_CURSOS
												INNER JOIN 4111_HORARIOSCURSOS
												ON 1111_CURSOS.1111_idcurso = 4111_HORARIOSCURSOS.1111_idcurso
												WHERE YEAR( 4111_fecalta ) < YEAR ( NOW() ) );												
	
	
	
-- QUERY 14.QUIERO SABER CUANTOS CURSOS TENGO POR INSTALACION 

SELECT 
		CASE 	
			WHEN `1100_nominstalacion` IS NULL 
			THEN "Total cursos:" 
			ELSE `1100_nominstalacion` 
		END AS `1100_nominstalacion`,
	COUNT( DISTINCT 1111_CURSOS.1111_idcurso )AS NUMCURSOS
	FROM 1111_CURSOS
	INNER JOIN 1111A_REGISTROSCURSOS 
	ON 1111_CURSOS.1111_idcurso = 1111A_REGISTROSCURSOS.1111_idcurso
	AND 1111_CURSOS.1100_idinstalacion = 1111A_REGISTROSCURSOS.1100_idinstalacion
	INNER JOIN 3120_REGISTROCLIENTES
	ON 1111A_REGISTROSCURSOS.3100_idcliente = 3120_REGISTROCLIENTES.3100_idcliente
	AND 1111A_REGISTROSCURSOS.1100_idinstalacion = 3120_REGISTROCLIENTES.1100_idinstalacion
	RIGHT JOIN 1100_INSTALACIONESPADEL
	ON 3120_REGISTROCLIENTES.1100_idinstalacion = 1100_INSTALACIONESPADEL.1100_idinstalacion
	GROUP BY 1100_INSTALACIONESPADEL.1100_nominstalacion WITH ROLLUP;

		
	
-- QUERY 15.QUIERO SABER LOS CLIENTES QUE TIENE UN NIVEL QUE NO CORRESPONDE AL NIVEL DEL CURSO AL QUE ESTA APUNTADO 

SELECT 3100_CLIENTES.3100_nomcliente, T1.3000_idnivel AS NIVELCLIENTE, T2.3000_idnivel AS NIVELCURSO, 1111_CURSOS.1111_idcurso
	FROM 1111A_REGISTROSCURSOS 
	INNER JOIN 3120_REGISTROCLIENTES
	ON 1111A_REGISTROSCURSOS.3100_idcliente = 3120_REGISTROCLIENTES.3100_idcliente
	AND 1111A_REGISTROSCURSOS.1100_idinstalacion = 3120_REGISTROCLIENTES.1100_idinstalacion
	INNER JOIN 3100_CLIENTES
	ON 3120_REGISTROCLIENTES.3100_idcliente = 3100_CLIENTES.3100_idcliente
	INNER JOIN 3000_NIVELES T1
	ON 3100_CLIENTES.3000_idnivel = T1.3000_idnivel
	INNER JOIN 1111_CURSOS
	ON 1111A_REGISTROSCURSOS.1100_idinstalacion = 1111_CURSOS.1100_idinstalacion
	AND 1111A_REGISTROSCURSOS.1111_idcurso = 1111_CURSOS.1111_idcurso
	INNER JOIN 3000_NIVELES T2
	ON 1111_CURSOS.3000_idnivel = T2.3000_idnivel
	WHERE T1.3000_idnivel != T2.3000_idnivel;
	
-- QUERY 16.QUIERO SABER CUANTOS CURSOS HE DADO DE ALTA POR MES EN ESTE AÑO

SELECT MONTHNAME( 4111_HORARIOSCURSOS.4111_fecalta ) AS MES, COUNT( DISTINCT 1111_CURSOS.1111_idcurso ) AS NUMCURSOS
	FROM 1111A_REGISTROSCURSOS
	INNER JOIN 1111_CURSOS
	ON 1111A_REGISTROSCURSOS.1111_idcurso = 1111_CURSOS.1111_idcurso
	AND 1111A_REGISTROSCURSOS.1100_idinstalacion = 1111_CURSOS.1100_idinstalacion
	INNER JOIN 4111_HORARIOSCURSOS
	ON 1111_CURSOS.1111_idcurso = 4111_HORARIOSCURSOS.1111_idcurso
	WHERE YEAR( 4111_HORARIOSCURSOS.4111_fecalta ) = YEAR ( NOW() )
	GROUP BY MONTHNAME( 4111_HORARIOSCURSOS.4111_fecalta )
	ORDER BY MONTHNAME( 4111_HORARIOSCURSOS.4111_fecalta )DESC;
	
-- QUERY 17.QUIERO SABER A CUANTOS CURSOS ESTAN APUNTADOS LOS CLIENTES , SI NO ESTAN APUNTADOS A NINGUNO QUE TAMBIEN SE MUESTRE 

SELECT 3100_CLIENTES.3100_nomcliente, COUNT( 1111A_REGISTROSCURSOS.1111_idcurso )AS NUMCURSOS
		FROM 1111_CURSOS 
		INNER JOIN 1111A_REGISTROSCURSOS
		ON 1111_CURSOS.1111_idcurso = 1111A_REGISTROSCURSOS.1111_idcurso
		AND 1111_CURSOS.1100_idinstalacion = 1111A_REGISTROSCURSOS.1100_idinstalacion
		INNER JOIN 3120_REGISTROCLIENTES
		ON 1111A_REGISTROSCURSOS.3100_idcliente = 3120_REGISTROCLIENTES.3100_idcliente
		AND 1111A_REGISTROSCURSOS.1100_idinstalacion = 3120_REGISTROCLIENTES.1100_idinstalacion
		RIGHT JOIN 3100_CLIENTES
		ON 3120_REGISTROCLIENTES.3100_idcliente = 3100_CLIENTES.3100_idcliente
		GROUP BY 3100_CLIENTES.3100_idcliente
		ORDER BY NUMCURSOS DESC; 
		
		
SELECT 3100_CLIENTES.3100_nomcliente, COUNT( 1111A_REGISTROSCURSOS.1111_idcurso )AS NUMCURSOS 
		FROM 3100_CLIENTES 
		LEFT JOIN 3120_REGISTROCLIENTES
		ON 3100_CLIENTES.3100_idcliente = 3120_REGISTROCLIENTES.3100_idcliente
		LEFT JOIN 1111A_REGISTROSCURSOS
		ON 3120_REGISTROCLIENTES.3100_idcliente = 1111A_REGISTROSCURSOS.3100_idcliente
		AND 3120_REGISTROCLIENTES.1100_idinstalacion = 1111A_REGISTROSCURSOS.1100_idinstalacion
		LEFT JOIN 1111_CURSOS
		ON 1111A_REGISTROSCURSOS.1111_idcurso = 1111_CURSOS.1111_idcurso
		AND 1111A_REGISTROSCURSOS.1100_idinstalacion = 1111_CURSOS.1100_idinstalacion
		GROUP BY 3100_CLIENTES.3100_idcliente
		ORDER BY NUMCURSOS DESC;
		


-- QUERY 18.QUIERO SABER QUE CURSOS TENGO POR AÑO , QUE CUENTES CUANTOS ALUMNOS TENGO EN CADA UNO Y QUE PROFESOR LO IMPARTE
--  PERO QUE ME MUESTRE SOLO LOS CURSOS QUE TENGAN MENOS DE 4 ALUMNOS	

	
SELECT YEAR( 4111_HORARIOSCURSOS.4111_fecalta ) AS AÑO,
	1111A_REGISTROSCURSOS.1111_idcurso,
	COUNT( 1111A_REGISTROSCURSOS.3100_idcliente ) AS NUMALUMNOS,
	2000_PROFESORES.2000_nomprofesor
		FROM 1111_CURSOS 
		INNER JOIN 4111_HORARIOSCURSOS
		ON 1111_CURSOS.1111_idcurso = 4111_HORARIOSCURSOS.1111_idcurso
		INNER JOIN 1111A_REGISTROSCURSOS
		ON 1111_CURSOS.1111_idcurso = 1111A_REGISTROSCURSOS.1111_idcurso
		AND 1111_CURSOS.1100_idinstalacion = 1111A_REGISTROSCURSOS.1100_idinstalacion
		INNER JOIN 2000_PROFESORES
		ON 1111_CURSOS.2000_idprofesor = 2000_PROFESORES.2000_idprofesor
		GROUP BY 1111A_REGISTROSCURSOS.1111_idcurso
		HAVING COUNT( 1111A_REGISTROSCURSOS.3100_idcliente )<4
		ORDER BY YEAR( 4111_HORARIOSCURSOS.4111_fecalta );
																	
		

-- QUERY 19.QUIERO CLASIFICAR POR NIVELES DE LOS CURSOS, SABER CUANTOS CLIENTES HAY EN CADA NIVEL DE CURSO 

		
SELECT 3000_NIVELES.3000_nomnivel AS NIVELESCURSOS, COUNT( 1111A_REGISTROSCURSOS.3100_idcliente ) AS NUMALUMNOS
		FROM 1111_CURSOS 
		INNER JOIN 1111A_REGISTROSCURSOS
		ON 1111_CURSOS.1111_idcurso = 1111A_REGISTROSCURSOS.1111_idcurso
		AND 1111_CURSOS.1100_idinstalacion = 1111A_REGISTROSCURSOS.1100_idinstalacion
		INNER JOIN 3120_REGISTROCLIENTES
		ON 1111A_REGISTROSCURSOS.3100_idcliente = 3120_REGISTROCLIENTES.3100_idcliente
		AND 1111A_REGISTROSCURSOS.1100_idinstalacion = 3120_REGISTROCLIENTES.1100_idinstalacion
		INNER JOIN 3000_NIVELES
		ON 1111_CURSOS.3000_idnivel = 3000_NIVELES.3000_idnivel
		GROUP BY 3000_NIVELES.3000_nomnivel
		ORDER BY NUMALUMNOS DESC;
		
		
-- QUERY 20. QUIERO SABER QUE PORCENTAJE POR NIVELES TIENE CADA PROFESOR DE LOS CURSOS QUE IMPARTEN
   	  
											
 
WITH Q1 AS( SELECT T1.2000_nomprofesor AS NOMBREPROF,
					3000_nomnivel AS NIVEL, 
					COUNT( * ) AS CURSOSPORNIVEL,
					( SELECT COUNT( * )
					FROM 1111_CURSOS T3, 2000_PROFESORES T2
					WHERE T3.2000_idprofesor = T2.2000_idprofesor
					AND T1.2000_idprofesor = T2.2000_idprofesor
					GROUP BY T2.2000_nomprofesor ) AS CURSOSTOTAL 
			FROM 2000_PROFESORES T1, 1111_CURSOS T4, 3000_NIVELES   
			WHERE T1.2000_idprofesor = T4.2000_idprofesor
			AND T4.3000_idnivel = 3000_NIVELES.3000_idnivel
			GROUP BY T1.2000_nomprofesor, 3000_NIVELES.3000_nomnivel	  
					)
				
 
SELECT NOMBREPROF,
			NIVEL,
			CURSOSPORNIVEL, 
			CURSOSTOTAL, 
			CONCAT( ROUND( ( CURSOSPORNIVEL / CURSOSTOTAL * 100 ), 0 ), '%')AS PORCENTAJE
 FROM Q1;
 
 
 
 


-- ESTA NO CUENTA ---------------------------------------------------------------

SELECT CASE 
			WHEN `1100_nominstalacion` IS NULL 
			THEN "Total:" 
			ELSE `1100_nominstalacion` 
		END AS `1100_nominstalacion`,
	COUNT( 3120_REGISTROCLIENTES.3100_idcliente ) AS numclientes
	FROM 3100_CLIENTES
	INNER JOIN 3120_REGISTROCLIENTES
	ON 3100_CLIENTES.3100_idcliente = 3120_REGISTROCLIENTES.3100_idcliente
	INNER JOIN 1100_INSTALACIONESPADEL
	ON 3120_REGISTROCLIENTES.1100_idinstalacion = 1100_INSTALACIONESPADEL.1100_idinstalacion	
	GROUP BY 1100_nominstalacion  WITH ROLLUP;